<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Harshu‚Äôs Valentine Quest üíò</title>

<style>
:root{
  --bg1:#ffd1e8;
  --bg2:#ff8fb5;
  --bg3:#ff4d6d;
  --card:#fff5fb;
  --ink:#5c1737;
  --hot:#ff2d55;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  display:grid;
  place-items:center;
  font-family:"Comic Sans MS","Trebuchet MS",cursive;
  color:var(--ink);
  overflow:hidden;
  position:relative;
}

/* ================= BACKGROUND ================= */
#bgSlideshow{
  position:fixed;
  inset:0;
  z-index:-3;
  overflow:hidden;
  filter:blur(3px) brightness(0.9) saturate(1.1);
  transform:scale(1.01);
  transition:transform 1.2s ease;
}

.bg-slide{
  position:absolute;
  inset:0;
  background-position:50% 35%;
  background-size:cover;
  background-repeat:no-repeat;
  opacity:0;
  transform:scale(1.01);
  transition:opacity 1.1s ease, transform 6s ease;
}

.bg-slide.active{
  opacity:1;
  transform:scale(1.03);
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  background:linear-gradient(
    135deg,
    rgba(255,209,232,.45),
    rgba(255,143,181,.45),
    rgba(255,77,109,.45)
  );
  z-index:-2;
}

body.yes-bg #bgSlideshow{
  transform:scale(1.04);
}

/* ================= ENVELOPE SCREEN ================= */
#envelopeScreen{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  background:
    radial-gradient(circle at 18% 20%, rgba(255,255,255,.2), transparent 30%),
    radial-gradient(circle at 85% 80%, rgba(255,143,181,.22), transparent 32%),
    rgba(15, 6, 16, 0.45);
  backdrop-filter:blur(8px);
  z-index:1000;
  transition:opacity .7s ease, transform .7s ease;
}

#envelopeScreen::before{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle, rgba(255,255,255,.24), transparent 60%);
  animation:openGlow 4s ease-in-out infinite;
  pointer-events:none;
}

@keyframes openGlow{
  0%, 100%{opacity:.2}
  50%{opacity:.45}
}

.open-copy{
  position:absolute;
  top:11%;
  text-align:center;
  color:#fff5fb;
  font-weight:700;
  letter-spacing:.04em;
  text-shadow:0 5px 16px rgba(0,0,0,.32);
}

.open-copy strong{
  display:block;
  font-size:clamp(20px, 3.3vw, 34px);
  margin-bottom:8px;
}

.open-copy span{
  font-size:clamp(12px, 2vw, 16px);
  opacity:.9;
}

.envelope-stage{
  width:min(88vw, 510px);
  height:min(66vh, 410px);
  position:relative;
  display:grid;
  place-items:center;
}

.confetti-dot{
  position:absolute;
  width:8px;
  height:8px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #fff, #ff8fb5);
  opacity:.65;
  animation:dotFloat var(--dur, 5s) linear infinite;
  animation-delay:var(--delay, 0s);
}

@keyframes dotFloat{
  from{transform:translateY(24px) scale(.7)}
  to{transform:translateY(-34px) scale(1.08)}
}

.envelope{
  width:min(86vw, 420px);
  height:min(52vh, 280px);
  position:relative;
  cursor:pointer;
  transform-style:preserve-3d;
  perspective:1200px;
  animation:idleBreathe 3.6s ease-in-out infinite;
}

@keyframes idleBreathe{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-5px)}
}

.flap{
  position:absolute;
  top:-2px;
  left:0;
  right:0;
  height:52%;
  clip-path:polygon(0 0, 100% 0, 50% 100%);
  background:linear-gradient(160deg, #ff4f83 0%, #ff2f69 62%, #d81a51 100%);
  transform-origin:top;
  transition:transform .9s cubic-bezier(.2,.8,.2,1), filter .6s ease;
  border-top-left-radius:14px;
  border-top-right-radius:14px;
  filter:drop-shadow(0 8px 14px rgba(0,0,0,.35));
  z-index:5;
}

.pocket{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  height:58%;
  clip-path:polygon(0 0, 100% 0, 50% 100%);
  background:linear-gradient(165deg,#ff98c1 0%,#ff7db0 55%, #ff5c95 100%);
  filter:drop-shadow(0 6px 14px rgba(0,0,0,.25));
  z-index:3;
}

.env-bg{
  position:absolute;
  inset:0;
  background:linear-gradient(150deg,#ffd4e7 0%,#ffb5d2 45%, #ff95bf 100%);
  border-radius:18px;
  border:1px solid rgba(255,255,255,.72);
  box-shadow:0 20px 35px rgba(0,0,0,.26), inset 0 1px 0 rgba(255,255,255,.55);
  z-index:1;
}

.letter{
  position:absolute;
  width:89%;
  left:5.5%;
  bottom:8px;
  height:82%;
  background:linear-gradient(180deg,#fff,#fff7fc);
  border-radius:16px;
  display:flex;
  flex-direction:column;
  justify-content: center;
  align-items: center;
  text-align:center;
  padding:22px 18px;
  border:1px solid rgba(255,105,160,.15);
  box-shadow: 0 12px 20px rgba(0,0,0,.18);
  transition:transform 1s cubic-bezier(.2,.8,.2,1), opacity .55s ease;
  z-index:2;
}

.letter p{
  font-size:17px;
  color:#5c1737;
  margin:0;
  line-height:1.45;
  font-weight:700;
}

.letter span{
  display:inline-block;
  margin-top:8px;
  font-size:12px;
  color:#ff2d63;
  font-weight:700;
  text-transform:uppercase;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,143,181,.22);
}

.seal{
  position:absolute;
  left:50%;
  top:52%;
  transform:translate(-50%,-50%);
  width:64px;
  height:64px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #ff84ab, #ff346a 70%, #d9134b);
  display:grid;
  place-items:center;
  color:#fff;
  font-size:26px;
  box-shadow:0 10px 18px rgba(0,0,0,.28), inset 0 2px 4px rgba(255,255,255,.35);
  z-index:7;
  transition:transform .7s ease, opacity .6s ease;
}

.pull-hint{
  position:absolute;
  bottom:-40px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  font-weight:700;
  color:#fff7fc;
  letter-spacing:.08em;
  opacity:.85;
  text-transform:uppercase;
  animation:hintPulse 1.5s ease-in-out infinite;
}

@keyframes hintPulse{
  0%,100%{opacity:.55; transform:translateX(-50%) translateY(0)}
  50%{opacity:.95; transform:translateX(-50%) translateY(-4px)}
}

.seal-crack{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  color:rgba(255,255,255,.92);
  font-size:24px;
  opacity:0;
  transform:scale(.6) rotate(-10deg);
  transition:opacity .35s ease, transform .4s ease;
  pointer-events:none;
}

.envelope.seal-broken .seal{
  transform:translate(-50%,-50%) scale(.96);
  box-shadow:0 7px 14px rgba(0,0,0,.24), inset 0 1px 2px rgba(255,255,255,.28);
}

.envelope.seal-broken .seal-crack{
  opacity:1;
  transform:scale(1) rotate(-3deg);
}

.envelope.seal-broken .pull-hint{
  opacity:.95;
  animation:none;
}

.envelope.open .flap{
  transform:rotateX(-176deg) translateY(-4px);
  z-index:0;
  filter:brightness(1.08);
}

.envelope.open .letter{
  transform:translateY(-182px) scale(1.03);
  z-index:5;
}

.envelope.open .seal{
  transform:translate(-50%,-72%) scale(.2) rotate(20deg);
  opacity:0;
}

.envelope.open .seal-crack{
  opacity:0;
}

.envelope.open .pull-hint{
  opacity:0;
}

#envelopeScreen.opened{
  transform:scale(1.04);
  opacity:0;
}

/* ================= MAIN CARD ================= */
.card{
  width:min(90vw,500px);
  background:rgba(255,245,251,0.85);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  padding:30px 20px;
  border-radius:24px;
  text-align:center;
  box-shadow:0 15px 40px rgba(255,0,102,.3);
  position:relative;
  z-index:10;
  display:none; /* Hidden initially */
  border:1px solid rgba(255,255,255,0.6);
}

.card::before,
.card::after{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:28px;
  background:
    radial-gradient(circle at 20% 20%, rgba(255,255,255,0.7), transparent 40%),
    radial-gradient(circle at 80% 20%, rgba(255,255,255,0.6), transparent 35%),
    radial-gradient(circle at 30% 80%, rgba(255,255,255,0.7), transparent 40%),
    linear-gradient(135deg, rgba(255,255,255,0.6), rgba(255,143,181,0.25));
  z-index:-1;
  filter:blur(2px);
}

.card::after{
  inset:-12px;
  opacity:0.35;
  filter:blur(8px);
}

.card.visible{
  display:block;
  animation:popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes popIn{
  from{opacity:0; transform:scale(0.8);}
  to{opacity:1; transform:scale(1);}
}

.badge{
  background:linear-gradient(135deg,#ffd1e8,#ff7eb3);
  padding:5px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:bold;
  color:#5c1737;
  display:inline-block;
  margin-bottom:10px;
  letter-spacing: 0.5px;
}

h1{
  color:#ff3b78;
  margin:5px 0 15px;
  font-size: 24px;
}

#question{
  font-size:20px;
  margin:20px 0;
  min-height: 50px;
  display:flex;
  align-items: center;
  justify-content: center;
}

.desc-wrap{
  display:none;
  width:100%;
  margin-top:8px;
}

.desc-wrap.visible{
  display:block;
}

#descHint{
  margin-top:8px;
  font-size:13px;
  color:#8b2f52;
  min-height:20px;
}

.desc-meter{
  width:100%;
  height:10px;
  border-radius:999px;
  background:rgba(255,143,181,0.25);
  overflow:hidden;
  margin-top:6px;
}

.desc-meter-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background:linear-gradient(90deg,#ff9acb,#ff4d6d);
  transition:width 0.22s ease;
}

#descInput{
  width:100%;
  min-height:96px;
  resize:vertical;
  border:1px solid rgba(255,143,181,0.55);
  border-radius:14px;
  padding:12px 14px;
  font-family:inherit;
  font-size:15px;
  line-height:1.35;
  color:#5c1737;
  background:rgba(255,255,255,0.92);
  outline:none;
}

#descInput:focus{
  border-color:#ff4d6d;
  box-shadow:0 0 0 3px rgba(255,77,109,0.16);
}

#descNextBtn{
  margin-top:10px;
  background:linear-gradient(145deg,#ff4d6d,#ff2d55);
  color:#fff;
  box-shadow:0 5px 15px rgba(255,45,85,0.35);
}

.cute-single{
  width:100%;
  display:flex;
  justify-content:center;
  margin:12px 0 6px;
}

.cute-sticker{
  width:90px;
  height:68px;
  object-fit:contain;
  border-radius:18px;
  padding:6px;
  background:rgba(255,255,255,0.8);
  box-shadow:0 8px 16px rgba(255,45,85,0.18);
  border:1px solid rgba(255,143,181,0.35);
  transform:rotate(var(--tilt, -3deg)) scale(var(--sticker-scale, 1));
  transition:transform 0.2s ease;
}

.cute-sticker:hover{
  transform:rotate(0deg) scale(1.06);
}


.btns{
  position:relative;
  min-height:130px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:20px;
  margin-top:15px;
}

button{
  border:none;
  padding:12px 30px;
  font-size:18px;
  border-radius:50px;
  cursor:pointer;
  font-family:inherit;
  transition: transform 0.1s;
}

button:active{ transform:scale(0.95); }

#yesBtn{
  background:linear-gradient(145deg,#ff4d6d,#ff2d55);
  color:white;
  box-shadow:0 5px 15px rgba(255,45,85,0.4);
  position:relative;
  z-index:1;
}

#noBtn{
  background:white;
  border:2px solid #ff8fb5;
  color:#ff4d6d;
  position:absolute;
  z-index:2;
}

/* TEXT */
#funny{
  margin-top:20px;
  min-height:24px;
  color:#a0264e;
  font-size:15px;
  font-style: italic;
}

.progress{
  margin-top:10px;
  font-size:11px;
  color:#8b2f52;
  opacity: 0.7;
}

/* ANIMATIONS */
@keyframes heartBeat{
  0%{transform:scale(1)}
  25%{transform:scale(1.1)}
  50%{transform:scale(1)}
  75%{transform:scale(1.1)}
  100%{transform:scale(1)}
}

.card.yes-clicked{
  animation:heartBeat 0.6s ease;
}

/* FLOATING HEARTS */
.heart{
  position:fixed;
  bottom:-30px;
  animation:floatUp 5s linear forwards;
  pointer-events:none;
  z-index: 50;
}

@keyframes floatUp{
  to{transform:translateY(-110vh) rotate(360deg); opacity:0}
}

/* FLOATING SPARKLES */
.sparkle{
  position:fixed;
  top:110vh;
  animation:floatUp 6s linear forwards;
  pointer-events:none;
  z-index:40;
}

/* SOUNDS HIDDEN */
audio{ display:none; }

#musicToggle{
  position:fixed;
  right:16px;
  bottom:16px;
  width:44px;
  height:44px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,0.8);
  background:rgba(255,255,255,0.82);
  color:#5c1737;
  font-size:20px;
  display:none;
  place-items:center;
  z-index:1100;
  box-shadow:0 8px 20px rgba(0,0,0,0.18);
}

#musicToggle.visible{
  display:grid;
}

</style>
</head>

<body>
<div id="bgSlideshow" aria-hidden="true">
  <div class="bg-slide active"></div>
  <div class="bg-slide"></div>
</div>

<audio id="heartbeat">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-heartbeat-206.mp3" type="audio/mpeg">
</audio>
<audio id="heartbreak">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-glass-break-with-impact-1683.mp3" type="audio/mpeg">
</audio>
<audio id="bgMusic" loop preload="auto">
  <source src="bear-5_gupl8HCy.mp3" type="audio/mpeg">
</audio>
<button id="musicToggle" type="button" aria-label="Mute background music" aria-pressed="false">üîä</button>

<div id="envelopeScreen">
  <div class="open-copy">
    <strong>A Little Surprise For You</strong>
    <span>Tap the sealed letter to begin</span>
  </div>
  <div class="envelope-stage" aria-hidden="true">
    <div class="confetti-dot" style="left:8%; top:64%; --dur:4.2s; --delay:.2s;"></div>
    <div class="confetti-dot" style="left:18%; top:22%; --dur:5.1s; --delay:.7s;"></div>
    <div class="confetti-dot" style="left:29%; top:74%; --dur:4.8s; --delay:1.1s;"></div>
    <div class="confetti-dot" style="left:77%; top:21%; --dur:4.5s; --delay:.5s;"></div>
    <div class="confetti-dot" style="left:90%; top:62%; --dur:5.4s; --delay:1.4s;"></div>
    <div class="confetti-dot" style="left:70%; top:78%; --dur:4.7s; --delay:.9s;"></div>
  </div>
  <div class="envelope" role="button" tabindex="0" aria-label="Open love letter">
    <div class="env-bg"></div>
    <div class="letter">
      <p>For someone who makes my heart smile üíñ</p>
      <span>Open me</span>
    </div>
    <div class="pocket"></div>
    <div class="flap"></div>
    <div class="seal">‚ù§
      <span class="seal-crack">‚ú¶</span>
    </div>
    <div class="pull-hint">Tap seal to start</div>
  </div>
</div>

<div class="card" id="card">
  <div class="badge">Harshu‚Äôs Valentine Quest üíò</div>
  <h1 id="chapterTitle">Chapter 1: The Love Quiz</h1>
  
  <div class="cute-single" aria-label="Cute bear">
    <img class="cute-sticker" id="cuteSticker" src="bear-1.webp" alt="cute bear"/>
  </div>

  <div id="question">Loading...</div>
  <div class="desc-wrap" id="descWrap">
    <textarea id="descInput" placeholder="Write your answer here..."></textarea>
    <div class="desc-meter" aria-hidden="true">
      <div class="desc-meter-fill" id="descMeterFill"></div>
    </div>
    <div id="descHint">Let your heart speak in a few words ‚ú®</div>
    <button id="descNextBtn" type="button">Save & Next</button>
  </div>

  <div class="btns">
    <button id="yesBtn">YES</button>
    <button id="noBtn">NO</button>
  </div>

  <div id="funny"></div>
  <div class="progress" id="progress"></div>
</div>
<script>

let audioUnlocked = false;
const heartbeat = document.getElementById("heartbeat");
const heartbreak = document.getElementById("heartbreak");
const bgMusic = document.getElementById("bgMusic");
const musicToggle = document.getElementById("musicToggle");
let musicEnabled = true;

function vibratePattern(pattern){
  if (navigator.vibrate) navigator.vibrate(pattern);
}

function playBgMusic(){
  if (!bgMusic) return;
  bgMusic.muted = !musicEnabled;
  bgMusic.volume = 0.35;
  if (musicEnabled) bgMusic.play().catch(() => {});
}

function updateMusicToggle(){
  if (!musicToggle) return;
  musicToggle.textContent = musicEnabled ? "üîä" : "üîá";
  musicToggle.setAttribute("aria-label", musicEnabled ? "Mute background music" : "Unmute background music");
  musicToggle.setAttribute("aria-pressed", String(!musicEnabled));
}

function unlockAudioOnce() {
  if (audioUnlocked) return;
  audioUnlocked = true;

  heartbeat.muted = true;
  heartbeat.play()
    .then(() => {
      heartbeat.pause();
      heartbeat.currentTime = 0;
      heartbeat.muted = false;
    })
    .catch(() => {});

  if (heartbreak) {
    heartbreak.muted = true;
    heartbreak.play()
      .then(() => {
        heartbreak.pause();
        heartbreak.currentTime = 0;
        heartbreak.muted = false;
      })
      .catch(() => {});
  }

  if (bgMusic) {
    bgMusic.muted = true;
    bgMusic.play()
      .then(() => {
        bgMusic.pause();
        bgMusic.currentTime = 0;
        bgMusic.muted = false;
      })
      .catch(() => {});
  }

  updateMusicToggle();
}

document.addEventListener("touchstart", unlockAudioOnce, { once: true });
document.addEventListener("click", unlockAudioOnce, { once: true });


/* ================= LOGIC ================= */
const envelope = document.querySelector(".envelope");
const envelopeScreen = document.getElementById("envelopeScreen");
const card = document.getElementById("card");
const pullHint = document.querySelector(".pull-hint");
const bgSlides = document.querySelectorAll(".bg-slide");
const bgImages = [
  { src: "WhatsApp Image 2026-02-09 at 23.10.41.jpeg", pos: "50% 24%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.41 (1).jpeg", pos: "50% 24%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.41 (2).jpeg", pos: "50% 30%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.41 (3).jpeg", pos: "50% 22%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.41 (4).jpeg", pos: "50% 28%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.41 (5).jpeg", pos: "50% 26%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.42.jpeg", pos: "50% 30%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.42 (1).jpeg", pos: "50% 24%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.42 (2).jpeg", pos: "50% 24%" },
  { src: "WhatsApp Image 2026-02-09 at 23.10.42 (3).jpeg", pos: "50% 26%" }
];
let bgIndex = 0;
let bgLayer = 0;
let bgTimer = null;

function setSlideBackground(slide, imageItem){
  if (!slide) return;
  slide.style.backgroundImage = `url("${imageItem.src}")`;
  slide.style.backgroundPosition = imageItem.pos || "50% 35%";
}

function stopBackgroundSlideshow(){
  if (bgTimer){
    clearInterval(bgTimer);
    bgTimer = null;
  }
}

function startBackgroundSlideshow(){
  if (!bgSlides.length || !bgImages.length) return;

  bgImages.forEach((item) => {
    const img = new Image();
    img.src = item.src;
  });

  bgIndex = 0;
  bgLayer = 0;
  setSlideBackground(bgSlides[0], bgImages[0]);
  if (bgSlides[1]) {
    setSlideBackground(bgSlides[1], bgImages[1 % bgImages.length]);
    bgSlides[1].classList.remove("active");
  }
  bgSlides[0].classList.add("active");

  if (bgImages.length < 2 || bgSlides.length < 2) return;

  stopBackgroundSlideshow();
  bgTimer = setInterval(() => {
    bgIndex = (bgIndex + 1) % bgImages.length;
    const nextLayer = (bgLayer + 1) % bgSlides.length;
    setSlideBackground(bgSlides[nextLayer], bgImages[bgIndex]);
    bgSlides[nextLayer].classList.add("active");
    bgSlides[bgLayer].classList.remove("active");
    bgLayer = nextLayer;
  }, 5000);
}

// Envelope Click
let envelopeOpened = false;
let sealBroken = false;

function openEnvelopeExperience(){
  if (!sealBroken){
    sealBroken = true;
    envelope.classList.add("seal-broken");
    if (pullHint) pullHint.textContent = "Tap once more to open";
    vibratePattern([18]);
    return;
  }

  if (envelopeOpened) return;
  envelopeOpened = true;
  envelope.classList.add("open");
  envelopeScreen.classList.add("opened");
  vibratePattern([24, 26, 30]);
  if (musicToggle) musicToggle.classList.add("visible");
  playBgMusic();

  setTimeout(() => {
    envelopeScreen.style.opacity = "0";
    setTimeout(()=>{
      envelopeScreen.remove();
      card.classList.add("visible");
    }, 420);
  }, 1650);
}

envelope.addEventListener("click", openEnvelopeExperience);
envelope.addEventListener("keydown", (event) => {
  if (event.key === "Enter" || event.key === " "){
    event.preventDefault();
    openEnvelopeExperience();
  }
});

const questions = [
  { type: "yesno", text: "Am I your favorite person to share random daily stories with?" },
  { type: "yesno", text: "Do you smile at least once a day because of something I say or do?" },
  { type: "yesno", text: "Do you believe we should always try to solve our misunderstandings before the day ends?" },
  { type: "yesno", text: "Do you feel safe expressing your real emotions with me, even when we disagree?" },
  { type: "yesno", text: "Do you believe our relationship grows stronger every time we work through a difficult moment together?" },
  { type: "descriptive", text: "When you feel upset or overwhelmed, what is the one thing I can do that comforts you the most?" },
  { type: "descriptive", text: "What is one small thing I can improve so you feel more understood and valued?" },
  { type: "yesno", text: "No matter how many silly fights or emotional days we have, will you still choose to stay, grow, and create memories with me?" }
];

const stickerImages = [
  {src:"bear-1.webp", alt:"cute bear waving"},
  {src:"bear-2.webp", alt:"bear hug"},
  {src:"bear-3.webp", alt:"panda stacking jars"},
  {src:"bear-4.webp", alt:"panda with sunglasses"},
  {src:"bear-5.webp", alt:"panda kiss"}
];

const yesLines = [
  "Okay‚Ä¶ that was cute üò≥",
  "That felt sincere.",
  "My heart noticed that.",
  "I‚Äôm blushing now.",
  "This is serious üíó",
  "You‚Äôre winning me over.",
  "Almost there‚Ä¶",
  "BEST ANSWER EVER ‚ù§Ô∏è"
];

const noLines = [
  "Aww‚Ä¶ missed it ü•∫",
  "That was adorable though",
  "You‚Äôre pretending now üòå",
  "I know what you want to click üòâ",
  "Almost‚Ä¶ almost!",
  "Your heart clicked YES",
  "Don‚Äôt overthink it üíï",
  "Okay, last chance üòè"
];

let qIndex = 0;
let finaleHeartsTimer = null;

const q = document.getElementById("question");
const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");
const btnArea = document.querySelector(".btns");
const funny = document.getElementById("funny");
const progress = document.getElementById("progress");
const cuteSticker = document.getElementById("cuteSticker");
const descWrap = document.getElementById("descWrap");
const descInput = document.getElementById("descInput");
const descNextBtn = document.getElementById("descNextBtn");
const descHint = document.getElementById("descHint");
const descMeterFill = document.getElementById("descMeterFill");
const descriptiveAnswers = {};
const answersReport = {};
const MIN_DESC_WORDS = 8;

function countWords(text){
  const trimmed = text.trim();
  if (!trimmed) return 0;
  return trimmed.split(/\s+/).length;
}

function updateDescriptiveFeedback(){
  const words = countWords(descInput.value);
  const pct = Math.min(100, (words / MIN_DESC_WORDS) * 100);
  if (descMeterFill) descMeterFill.style.width = `${pct}%`;

  if (!descHint) return;
  if (words === 0){
    descHint.textContent = `Write at least ${MIN_DESC_WORDS} words to unlock next üíå`;
    return;
  }
  if (words < MIN_DESC_WORDS){
    descHint.textContent = `${words}/${MIN_DESC_WORDS} words... keep going, your love letter is blooming üå∏`;
    return;
  }
  descHint.textContent = `${words} words ‚Äî beautiful, this is ready ‚ú®`;
}

function placeNoAtStart(){
  if (!btnArea) return;
  const areaW = btnArea.clientWidth;
  const areaH = btnArea.clientHeight;
  const btnW = noBtn.offsetWidth || 96;
  const btnH = noBtn.offsetHeight || 48;
  const padding = 8;
  const yesRect = yesBtn.getBoundingClientRect();
  const areaRect = btnArea.getBoundingClientRect();

  const yesRight = yesRect.right - areaRect.left;
  const rightStart = yesRight + 22;
  const startLeft = Math.min(areaW - btnW - padding, Math.max(padding, rightStart));
  const startTop = Math.max(padding, (areaH - btnH) / 2);

  noBtn.style.left = `${Math.max(padding, startLeft)}px`;
  noBtn.style.top = `${startTop}px`;
}

function showQ(){
  const current = questions[qIndex];
  q.textContent = current.text;
  progress.textContent = `Question ${qIndex+1} of ${questions.length}`;
  funny.textContent = "";

  const sticker = stickerImages[qIndex % stickerImages.length];
  if(cuteSticker && sticker){
    cuteSticker.src = sticker.src;
    cuteSticker.alt = sticker.alt;
  }

  const grow = 1 + (qIndex * 0.08);
  yesBtn.style.transform = `scale(${grow})`;

  if (current.type === "descriptive"){
    btnArea.style.display = "none";
    descWrap.classList.add("visible");
    descInput.value = descriptiveAnswers[qIndex] || "";
    updateDescriptiveFeedback();
    setTimeout(() => descInput.focus(), 50);
  } else {
    descWrap.classList.remove("visible");
    btnArea.style.display = "flex";
    noBtn.style.display = "block";
    placeNoAtStart();
  }
}

function spawnHearts(count=15){
  for(let i=0; i<count; i++){
    const h = document.createElement("div");
    h.className = "heart";
    h.textContent = ["üíñ","üíï","üíò","‚ù§Ô∏è","‚ú®"][Math.floor(Math.random()*5)];
    h.style.left = Math.random()*100 + "vw";
    h.style.fontSize = (15 + Math.random()*30) + "px";
    h.style.animationDuration = (3 + Math.random()*3) + "s";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(), 6000);
  }
}

function spawnSparkles(count=10){
  for(let i=0; i<count; i++){
    const s = document.createElement("div");
    s.className = "sparkle";
    s.textContent = ["‚ú®","üí´","‚≠ê"][Math.floor(Math.random()*3)];
    s.style.left = Math.random()*100 + "vw";
    s.style.fontSize = (12 + Math.random()*18) + "px";
    s.style.animationDuration = (4 + Math.random()*3) + "s";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(), 7000);
  }
}

function moveNo(){
  const current = questions[qIndex];
  if (!current || current.type !== "yesno") return;
  const rect = (noBtn.offsetParent || btnArea).getBoundingClientRect();
  const btnRect = noBtn.getBoundingClientRect();
  const yesRect = yesBtn.getBoundingClientRect();
  const padding = 8;
  
  // Keep NO in the same button area and prefer zones that do not overlap YES.
  const maxLeft = Math.max(padding, rect.width - btnRect.width - padding);
  const maxTop = Math.max(padding, rect.height - btnRect.height - padding);

  let nextLeft = padding + Math.random() * (maxLeft - padding);
  let tries = 0;
  while (tries < 12){
    const candidateLeft = padding + Math.random() * (maxLeft - padding);
    const candidateRight = candidateLeft + btnRect.width;
    const yesLeft = yesRect.left - rect.left;
    const yesRight = yesRect.right - rect.left;
    const overlapsYesHorizontally = candidateRight > (yesLeft - 12) && candidateLeft < (yesRight + 12);
    if (!overlapsYesHorizontally){
      nextLeft = candidateLeft;
      break;
    }
    tries++;
  }

  noBtn.style.left = `${nextLeft}px`;
  noBtn.style.top = `${padding + Math.random() * (maxTop - padding)}px`;
  
  // Pick a random funny line
  funny.textContent = noLines[Math.floor(Math.random()*noLines.length)];
  
  vibratePattern([20,20,20]);
}

function buildAnswersReportText(){
  const now = new Date();
  const lines = [
    "Valentine Quest Answers Report",
    "=============================",
    `Generated: ${now.toLocaleString("en-IN", { timeZone: "Asia/Kolkata" })} IST`,
    "",
  ];

  questions.forEach((item, index) => {
    const answer = answersReport[index] || "(No answer captured)";
    lines.push(`${index + 1}. ${item.text}`);
    lines.push(`Answer: ${answer}`);
    lines.push("");
  });

  return lines.join("\n");
}

function downloadAnswersReport(reportText){
  const blob = new Blob([reportText], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = "valentine_answers_report.txt";
  document.body.appendChild(link);
  link.click();
  link.remove();
  URL.revokeObjectURL(url);
}

yesBtn.addEventListener("click", () => {
  const current = questions[qIndex];
  if (!current || current.type !== "yesno") return;
  answersReport[qIndex] = "YES";
  vibratePattern([60,30,80]);
  
  card.classList.add("yes-clicked");
  setTimeout(()=>card.classList.remove("yes-clicked"), 500);

  spawnHearts(20);
  spawnSparkles(8);
  if(heartbeat) { heartbeat.currentTime = 0; heartbeat.play().catch(()=>{}); }
  
  funny.textContent = yesLines[qIndex];
  
  if(qIndex < questions.length - 1){
    qIndex++;
    setTimeout(showQ, 1000);
  } else {
    finishGame();
  }
});

function handleDescriptiveNext(){
  const current = questions[qIndex];
  if (!current || current.type !== "descriptive") return;

  const value = descInput.value.trim();
  const words = countWords(value);
  if (words < MIN_DESC_WORDS){
    funny.textContent = `Please write at least ${MIN_DESC_WORDS} words üíå`;
    vibratePattern([16, 26, 16]);
    updateDescriptiveFeedback();
    descInput.focus();
    return;
  }

  descriptiveAnswers[qIndex] = value;
  answersReport[qIndex] = value;
  funny.textContent = "Saved üíñ";
  vibratePattern([20, 18]);

  if (qIndex < questions.length - 1){
    qIndex++;
    setTimeout(showQ, 350);
  } else {
    finishGame();
  }
}

descNextBtn.addEventListener("click", handleDescriptiveNext);
descInput.addEventListener("input", updateDescriptiveFeedback);
descInput.addEventListener("keydown", (event) => {
  if ((event.metaKey || event.ctrlKey) && event.key === "Enter"){
    handleDescriptiveNext();
  }
});

// Trigger move on pointer hover/tap/click
noBtn.addEventListener("pointerenter", moveNo);
noBtn.addEventListener("pointerdown", (e) => { 
  e.preventDefault(); 
  moveNo(); 
});
noBtn.addEventListener("click", (e) => {
  e.preventDefault();
  moveNo();
  if (heartbreak) {
    heartbreak.currentTime = 0;
    heartbreak.play().catch(() => {});
  }
});

function stopFinaleHearts(){
  if (finaleHeartsTimer){
    clearInterval(finaleHeartsTimer);
    finaleHeartsTimer = null;
  }
}

function startFinaleHearts(){
  stopFinaleHearts();
  finaleHeartsTimer = setInterval(() => spawnHearts(3), 500);
}

function finishGame(){
  const reportText = buildAnswersReportText();
  localStorage.setItem("valentine_answers_report", reportText);
  downloadAnswersReport(reportText);

  document.body.classList.add("yes-bg");
  card.innerHTML = `
    <h1 style="font-size:32px;color:#ff2d55;margin-bottom:20px;">YAYYYY üíò</h1>
    <p style="font-size:18px; line-height:1.6; color:#5c1737;">
      <strong>Harshu ‚ù§Ô∏è</strong><br/><br/>
      From silly questions to real feelings,<br/>
      it‚Äôs always you.<br/><br/>
      Today. Tomorrow.<br/>
      And every Valentine after this.
      <br/><br/>
      Happy Valentine‚Äôs Day, Kannamaaa‚ù§Ô∏è!
    </p>
    <div style="margin-top:30px; font-size:40px;">üíë</div>
    <button id="downloadReportBtn" type="button" style="margin-top:10px;">Download Report Again</button>
  `;

  const downloadReportBtn = document.getElementById("downloadReportBtn");
  if (downloadReportBtn){
    downloadReportBtn.addEventListener("click", () => downloadAnswersReport(reportText));
  }
  
  startFinaleHearts();
}

window.addEventListener("pagehide", () => {
  stopFinaleHearts();
  stopBackgroundSlideshow();
});

if (musicToggle){
  updateMusicToggle();
  musicToggle.addEventListener("click", () => {
    musicEnabled = !musicEnabled;
    updateMusicToggle();
    if (!bgMusic) return;
    bgMusic.muted = !musicEnabled;
    if (musicEnabled) {
      bgMusic.play().catch(() => {});
      vibratePattern([20, 20]);
    } else {
      bgMusic.pause();
      vibratePattern([10]);
    }
  });
}

startBackgroundSlideshow();
showQ();

</script>
</body>
</html>
